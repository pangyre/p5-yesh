---
auto_fieldset:
  legend: Configure the database
elements:
  - type: Text
    name: db_name
    label: Database name
    constraints: 
      - Required
      - type: Length
        min: 1
        max: 50
  - type: Text
    name: user
    label: Database user
    constraints: 
      - type: Required
        message: User is required for DBs other than SQLite
        when:
          field: dbd
          values: [ 'SQLite' ]
          not: 1
  - type: Text
    name: password
    label: Password
  - type: Text
    name: host
    label: Database host
    constraints:
      - type: Regex
        regex: '\A((?<=\A)|(?<=\w))\w(?:\w|\.\w)*((?=\w)|(?=\z))\z'
        message: Hostname looks malformed
  - type: Text
    name: port
    label: Port on host
    constraints: 
      - Integer
      - type: MaxRange
        max: 65535
      - type: MinRange
        min: 1
        message: Invalid port number
    attributes:
      style: "width:4em;"
  - type: Hidden
    default: normal
    name: normal
  - type: Select
    label: Database type
    constraint: Required
    name: dbd
    options:
      - [ '', 'Select your DB engine' ]
      - [ 'Pg', 'PostgreSQL' ]
      - [ 'mysql', 'MySQL' ]
      - [ 'SQLite', 'SQLite' ]
  - type: Text
    name: mysql_read_default_file
    label: MySQL default file
    attributes:
      style: "width:50%;"
  - type: Submit
    name: x
    value: Set-up the configuration
  - type: Block
    tag: script
    attributes:
      type: "text/javascript"
    content_xml: |
      //<![CDATA[
        $("*[name='dbd']").bind("change", function(){
          // alert(("input[name='mysql_read_default_file']").parent().text());
           $(this).val() == "mysql" ?
              $("input[name='mysql_read_default_file']").parent().fadeIn() :
              $("input[name='mysql_read_default_file']").parent().fadeOut();
           });
      //]]>
